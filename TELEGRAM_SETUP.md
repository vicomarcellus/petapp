# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

‚úÖ **–†–∞—Å–ø–∏—Å–∞–Ω–∏—è –ª–µ–∫–∞—Ä—Å—Ç–≤** - —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ N –¥–Ω–µ–π
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è** - Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
‚úÖ **Vercel Cron** - –Ω–∞–¥–µ–∂–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–∂–µ –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ
‚úÖ **Vercel Postgres** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
         ‚Üì
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Vercel Postgres
         ‚Üì
Vercel Cron –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
         ‚Üì
–ï—Å–ª–∏ –≤—Ä–µ–º—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
         ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
```

## API Endpoints

### POST /api/schedule-medication
–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞

**Body:**
```json
{
  "userId": "user_123",
  "chatId": "123456789",
  "petId": 1,
  "petName": "–ö–µ–Ω—Ç",
  "medicationName": "–ü—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω",
  "dosage": "0.3 –º–ª",
  "time": "09:00",
  "startDate": "2026-01-24",
  "daysCount": 5
}
```

### GET /api/get-schedules?userId=user_123
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### DELETE /api/delete-schedule
–£–¥–∞–ª–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

**Body:**
```json
{
  "scheduleId": 1,
  "userId": "user_123"
}
```

### POST /api/send-reminder
–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è cron –∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

**Body:**
```json
{
  "chatId": "123456789",
  "petName": "–ö–µ–Ω—Ç",
  "medicationName": "–ü—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω",
  "dosage": "0.3 –º–ª",
  "time": "09:00"
}
```

### GET /api/check-reminders
Cron endpoint (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)

**Headers:**
```
Authorization: Bearer CRON_SECRET
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ medication_schedules

```sql
CREATE TABLE medication_schedules (
  id SERIAL PRIMARY KEY,
  user_id VARCHAR(255) NOT NULL,
  chat_id VARCHAR(255) NOT NULL,
  pet_id INTEGER NOT NULL,
  pet_name VARCHAR(255) NOT NULL,
  medication_name VARCHAR(255) NOT NULL,
  dosage VARCHAR(255) NOT NULL,
  time VARCHAR(5) NOT NULL,
  start_date DATE NOT NULL,
  days_count INTEGER NOT NULL,
  color VARCHAR(50),
  note TEXT,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW()
);
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É:
- –ù–∞–∑–≤–∞–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞: "–ü—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω"
- –î–æ–∑–∏—Ä–æ–≤–∫–∞: "0.3 –º–ª"
- –í—Ä–µ–º—è: "09:00"
- –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞: "2026-01-24"
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π: 5

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/schedule-medication`

### 2. –•—Ä–∞–Ω–µ–Ω–∏–µ

–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Postgres:
```
id: 1
medication_name: "–ü—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω"
time: "09:00"
start_date: 2026-01-24
days_count: 5
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å 24.01 –ø–æ 28.01 –≤ 09:00

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ (Cron)

–ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É Vercel –≤—ã–∑—ã–≤–∞–µ—Ç `/api/check-reminders`:

```typescript
// –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: 2026-01-24 09:00
const currentTime = "09:00";
const currentDate = "2026-01-24";

// SQL –∑–∞–ø—Ä–æ—Å –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≥–¥–µ:
// - time = "09:00"
// - start_date <= "2026-01-24"
// - end_date >= "2026-01-24"
```

### 4. –û—Ç–ø—Ä–∞–≤–∫–∞

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:

```typescript
await fetch(
  `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,
  {
    method: 'POST',
    body: JSON.stringify({
      chat_id: schedule.chat_id,
      text: `üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ª–µ–∫–∞—Ä—Å—Ç–≤–µ\n\nüêæ –ü–∏—Ç–æ–º–µ—Ü: –ö–µ–Ω—Ç\nüíä –õ–µ–∫–∞—Ä—Å—Ç–≤–æ: –ü—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω\nüìè –î–æ–∑–∏—Ä–æ–≤–∫–∞: 0.3 –º–ª\n‚è∞ –í—Ä–µ–º—è: 09:00`,
      parse_mode: 'HTML',
    }),
  }
);
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **–¢–æ–∫–µ–Ω –±–æ—Ç–∞** - —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Vercel Environment Variables (–Ω–µ –≤ –∫–æ–¥–µ)
‚úÖ **CRON_SECRET** - –∑–∞—â–∏—â–∞–µ—Ç endpoint –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
‚úÖ **User ID** - –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
‚úÖ **HTTPS** - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **–¢–æ—á–Ω–æ—Å—Ç—å**: ¬±1 –º–∏–Ω—É—Ç–∞ (cron –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)
- **–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å**: UTC (–Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è)
- **–õ–∏–º–∏—Ç—ã Telegram**: 30 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É –Ω–∞ –±–æ—Ç–∞
- **Vercel Cron**: –±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 100 –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π –≤ –¥–µ–Ω—å

## –£–ª—É—á—à–µ–Ω–∏—è (TODO)

- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
- [ ] –ö–Ω–æ–ø–∫–∏ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö ("–î–∞–ª –ª–µ–∫–∞—Ä—Å—Ç–≤–æ", "–û—Ç–ª–æ–∂–∏—Ç—å")
- [ ] –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –µ—Å–ª–∏ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ N –º–∏–Ω—É—Ç –¥–æ –≤—Ä–µ–º–µ–Ω–∏
- [ ] –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–µ–∫–∞—Ä—Å—Ç–≤ –≤ –æ–¥–Ω–æ –≤—Ä–µ–º—è)
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —Å–∫–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, –ø—Ä–æ–ø—É—â–µ–Ω–æ
- [ ] Webhook –æ—Ç Telegram –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É cron:

1. Vercel Dashboard ‚Üí Functions ‚Üí check-reminders ‚Üí Logs
2. –ò–ª–∏ —á–µ—Ä–µ–∑ CLI: `vercel logs --follow`

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```sql
-- –í—Å–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
SELECT * FROM medication_schedules;

-- –ê–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
SELECT * FROM medication_schedules
WHERE is_active = true
AND start_date <= CURRENT_DATE
AND (start_date + (days_count || ' days')::interval)::date >= CURRENT_DATE;
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. –°–æ–∑–¥–∞–π—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è + 2 –º–∏–Ω—É—Ç—ã
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç:

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Chat ID (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º)
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ—Ç –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ cron —Ñ—É–Ω–∫—Ü–∏–∏
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ –∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ –¥–∞—Ç
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å (Vercel –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UTC)
