# Функционал чеклиста - Полное описание

## Восстановленные функции после миграции на Supabase

### 1. Группировка задач по статусу
- **Просроченные задачи** - красная подсветка, иконка предупреждения
- **Предстоящие задачи** - обычное отображение
- **Выполненные задачи** - зеленая подсветка, зачеркнутый текст

### 2. Типы задач с иконками
- **Лекарства** (medication) - фиолетовая иконка таблетки
- **Питание** (feeding) - зеленая иконка столовых приборов
- **Другое** (other) - серая иконка часов

### 3. Автосоздание задач
При добавлении записи в EntryView автоматически создается задача в чеклисте:

#### Лекарства
- Когда добавляешь лекарство → создается задача "Дать лекарство"
- Задача сразу отмечается как выполненная (completed: true)
- Связывается с записью лекарства (linked_item_id)
- Сохраняет название и дозировку (linked_item_name, linked_item_amount)

#### Питание
- Когда добавляешь питание → создается задача "Покормить"
- Задача сразу отмечается как выполненная (completed: true)
- Связывается с записью питания (linked_item_id)
- Сохраняет название и количество (linked_item_name, linked_item_amount)

### 4. Планирование задач на будущее
Кнопка "Запланировать" открывает расширенную форму:

- **Выбор типа задачи**: Лекарство / Питание / Другое
- **Время выполнения**: обязательное поле
- **Описание**: текст задачи
- **Для лекарств**: название + дозировка
- **Для питания**: название + количество

### 5. Уведомления о просроченных задачах
Хук `useTaskNotifications` проверяет задачи каждую минуту:

- Показывает всплывающее уведомление при наличии просроченных задач
- Отображает количество просроченных задач
- Показывает первые 3 задачи в уведомлении
- Можно закрыть уведомление кнопкой X

### 6. Отображение связанных данных
Для задач с типом medication/feeding показывается:
- Название связанного элемента
- Количество/дозировка
- Иконка соответствующего типа

### 7. Счетчики задач
Каждая группа показывает количество задач в скобках:
- Просроченные (3)
- Предстоящие (5)
- Выполненные (12)

## Структура данных ChecklistTask

```typescript
interface ChecklistTask {
  id?: number;
  user_id: string;
  pet_id: number;
  date: string; // YYYY-MM-DD
  time: string; // HH:mm
  timestamp: number; // для сортировки и проверки просрочки
  task: string; // Текст задачи
  completed: boolean;
  task_type?: 'medication' | 'feeding' | 'other';
  linked_item_id?: number; // ID связанного лекарства/корма
  linked_item_name?: string; // Название
  linked_item_amount?: string; // Дозировка/количество
  created_at?: string;
}
```

## Логика работы

### Автосоздание при добавлении записи
1. Пользователь добавляет лекарство/питание в EntryView
2. Создается запись в medication_entries/feeding_entries
3. Автоматически создается задача в checklist_tasks
4. Задача отмечается как выполненная (т.к. действие уже совершено)
5. Задача связывается с записью через linked_item_id

### Планирование задачи
1. Пользователь нажимает "Запланировать" в чеклисте
2. Выбирает тип задачи (лекарство/питание/другое)
3. Указывает время и детали
4. Создается задача со статусом completed: false
5. Задача появится в группе "Предстоящие" или "Просроченные"

### Проверка просрочки
- Задача считается просроченной если: `timestamp < Date.now()` и `completed === false`
- Проверка происходит каждую минуту через useTaskNotifications
- Просроченные задачи выделяются красным цветом

## Интеграция с другими компонентами

### EntryView
- При добавлении лекарства/питания автоматически создает задачу
- Использует `.select().single()` для получения ID созданной записи
- Передает все необходимые данные в checklist_tasks

### useTaskNotifications
- Подписывается на изменения в checklist_tasks
- Проверяет просроченные задачи каждую минуту
- Показывает уведомление при наличии просрочки

### Supabase Realtime
- Чеклист подписан на изменения таблицы checklist_tasks
- Автоматически обновляется при добавлении/изменении/удалении задач
- Фильтрует по pet_id текущего питомца
