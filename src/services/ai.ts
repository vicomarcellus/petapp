const OPENAI_API_KEY = import.meta.env.VITE_OPENAI_API_KEY;

interface ParsedScheduledMedication {
  name: string;
  amount: string;
  unit: string;
  time: string;
  recurring?: 'daily' | 'every_1h' | 'every_2h' | 'every_3h' | 'every_4h';
}

interface ParsedScheduledFeeding {
  name: string;
  amount: string;
  unit: 'g' | 'ml' | 'none';
  time: string;
  recurring?: 'daily' | 'every_1h' | 'every_2h' | 'every_3h' | 'every_4h';
}

interface ParsedTask {
  task: string;
  time: string;
  recurring?: 'daily' | 'every_1h' | 'every_2h' | 'every_3h' | 'every_4h'; // –î–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–¥–∞—á
}

interface ParsedFeeding {
  name: string;
  amount: string;
  unit: 'g' | 'ml' | 'none';
  time: string;
  note?: string;
}

interface ParsedMedication {
  name: string;
  dosage: string;
  time: string;
}

interface ParsedState {
  score: 1 | 2 | 3 | 4 | 5;
  time: string;
  note?: string;
}

interface ParsedSymptom {
  name: string;
  time: string;
  note?: string;
}

interface ParsedEntry {
  // –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
  states?: ParsedState[]; // –ú–∞—Å—Å–∏–≤ –∑–∞–ø–∏—Å–µ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è
  symptoms?: ParsedSymptom[]; // –ú–∞—Å—Å–∏–≤ –∑–∞–ø–∏—Å–µ–π —Å–∏–º–ø—Ç–æ–º–æ–≤
  medications?: ParsedMedication[]; // –ú–∞—Å—Å–∏–≤ –ª–µ–∫–∞—Ä—Å—Ç–≤
  feedings?: ParsedFeeding[]; // –ú–∞—Å—Å–∏–≤ –ø–∏—Ç–∞–Ω–∏—è
  tasks?: ParsedTask[]; // –ú–∞—Å—Å–∏–≤ –∑–∞–¥–∞—á –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
  scheduledMedications?: ParsedScheduledMedication[]; // –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞
  scheduledFeedings?: ParsedScheduledFeeding[]; // –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ
  
  // –°—Ç–∞—Ä—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  state_score?: 1 | 2 | 3 | 4 | 5;
  note?: string;
  
  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
  date?: string;
  action?: 'add' | 'remove' | 'clear' | 'update' | 'error' | 'chat';
  target?: 'symptom' | 'medication' | 'note' | 'state' | 'entry' | 'feeding' | 'task';
  itemName?: string;
  time?: string; // –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
  message?: string;
  navigateToDate?: string;
  showDetails?: boolean;
}

export interface AIContext {
  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∏—Ç–æ–º—Ü–µ
  petName?: string;
  petType?: string;
  
  // –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
  currentView?: string;
  currentDate?: string;
  currentMonth?: string;
  
  // –î–∞–Ω–Ω—ã–µ –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å
  existingStates?: string[];
  existingSymptoms?: string[];
  existingMedications?: string[];
  existingFeedings?: string[];
  hasEntry?: boolean;
  currentState?: number;
  hasNote?: boolean;
  
  // –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
  scheduledMedications?: string[];
  scheduledFeedings?: string[];
  
  // –î–∏–∞–≥–Ω–æ–∑—ã –ø–∏—Ç–æ–º—Ü–∞
  diagnoses?: Array<{
    date: string;
    diagnosis: string;
    notes?: string;
  }>;
  
  // –ò—Å—Ç–æ—Ä–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–Ω–∏
  recentHistory?: Array<{
    date: string;
    avgState?: number;
    symptoms: string[];
    medications: string[];
  }>;
  
  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  stats?: {
    avgStateLastWeek?: number;
    commonSymptoms?: string[];
    regularMedications?: string[];
  };
}

export async function parseEntryFromText(text: string, context?: AIContext): Promise<ParsedEntry> {
  if (!OPENAI_API_KEY) {
    throw new Error('OpenAI API key –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
  }

  // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  const now = new Date();
  const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
  const currentDate = now.toISOString().split('T')[0];

  // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–∏—Å—Ç–µ–º—ã
  let systemContext = '';
  if (context) {
    // –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ü–ò–¢–û–ú–¶–ï
    if (context.petName) {
      systemContext = `\n\n=== –ü–ò–¢–û–ú–ï–¶ ===\n–ò–º—è: ${context.petName}`;
      if (context.petType) {
        const typeRu = context.petType === 'cat' ? '–∫–æ—Ç/–∫–æ—à–∫–∞' : context.petType === 'dog' ? '—Å–æ–±–∞–∫–∞' : context.petType;
        systemContext += `\n–¢–∏–ø: ${typeRu}`;
      }
      systemContext += `\n\n–í–ê–ñ–ù–û: –í—Å–µ–≥–¥–∞ –Ω–∞–∑—ã–≤–∞–π –ø–∏—Ç–æ–º—Ü–∞ –ø–æ –∏–º–µ–Ω–∏ "${context.petName}", –∞ –Ω–µ "–ø–∏—Ç–æ–º–µ—Ü"!`;
    }
    
    systemContext += `\n\n=== –¢–ï–ö–£–©–ê–Ø –°–¢–†–ê–ù–ò–¶–ê ===\n${context.currentView === 'calendar' ? '–ö–∞–ª–µ–Ω–¥–∞—Ä—å (–≥–ª–∞–≤–Ω–∞—è)' : context.currentView === 'view' || context.currentView === 'edit' || context.currentView === 'add' ? `–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø–∏—Å–∏ –∑–∞ ${context.currentDate || '—Å–µ–≥–æ–¥–Ω—è'}` : context.currentView === 'settings' ? '–ù–∞—Å—Ç—Ä–æ–π–∫–∏' : context.currentView === 'activity' ? '–ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏' : context.currentView === 'diagnosis' ? '–î–∏–∞–≥–Ω–æ–∑—ã' : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`;
    
    if (context.currentMonth) {
      systemContext += `\n–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ: ${context.currentMonth}`;
    }
    
    // –î–ò–ê–ì–ù–û–ó–´ - –í–ê–ñ–ù–´–ô –ö–û–ù–¢–ï–ö–°–¢!
    if (context.diagnoses && context.diagnoses.length > 0) {
      systemContext += `\n\n=== –î–ò–ê–ì–ù–û–ó–´ –ü–ò–¢–û–ú–¶–ê (–í–ê–ñ–ù–û!) ===`;
      context.diagnoses.forEach(d => {
        systemContext += `\nüìã ${d.date}: ${d.diagnosis}`;
        if (d.notes) {
          systemContext += `\n   –ó–∞–º–µ—Ç–∫–∏: ${d.notes}`;
        }
      });
      systemContext += `\n\n–£—á–∏—Ç—ã–≤–∞–π —ç—Ç–∏ –¥–∏–∞–≥–Ω–æ–∑—ã –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö!`;
    }
    
    // –î–ê–ù–ù–´–ï –ó–ê –°–ï–ì–û–î–ù–Ø
    systemContext += `\n\n=== –î–ê–ù–ù–´–ï –ó–ê ${context.currentDate || '–°–ï–ì–û–î–ù–Ø'} (–¢–ï–ö–£–©–ê–Ø –°–¢–†–ê–ù–ò–¶–ê) ===`;
    if (context.hasEntry) {
      systemContext += `\n‚úì –ó–∞–ø–∏—Å—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç`;
      if (context.currentState) {
        systemContext += `\n‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: ${context.currentState}/5`;
      }
    } else {
      systemContext += `\n‚úó –ó–∞–ø–∏—Å–∏ –Ω–µ—Ç`;
    }
    
    if (context.existingStates && context.existingStates.length > 0) {
      systemContext += `\n‚Ä¢ –°–æ—Å—Ç–æ—è–Ω–∏—è: ${context.existingStates.join(', ')}`;
    } else {
      systemContext += `\n‚Ä¢ –°–æ—Å—Ç–æ—è–Ω–∏–π –Ω–µ—Ç`;
    }
    
    if (context.existingSymptoms && context.existingSymptoms.length > 0) {
      systemContext += `\n‚Ä¢ –°–∏–º–ø—Ç–æ–º—ã –°–ï–ì–û–î–ù–Ø: ${context.existingSymptoms.join(', ')}`;
    } else {
      systemContext += `\n‚Ä¢ –°–∏–º–ø—Ç–æ–º–æ–≤ –°–ï–ì–û–î–ù–Ø –Ω–µ—Ç`;
    }
    
    if (context.existingMedications && context.existingMedications.length > 0) {
      systemContext += `\n‚Ä¢ –õ–µ–∫–∞—Ä—Å—Ç–≤–∞: ${context.existingMedications.join(', ')}`;
    } else {
      systemContext += `\n‚Ä¢ –õ–µ–∫–∞—Ä—Å—Ç–≤ –Ω–µ—Ç`;
    }
    
    if (context.existingFeedings && context.existingFeedings.length > 0) {
      systemContext += `\n‚Ä¢ –ü–∏—Ç–∞–Ω–∏–µ: ${context.existingFeedings.join(', ')}`;
    } else {
      systemContext += `\n‚Ä¢ –ü–∏—Ç–∞–Ω–∏—è –Ω–µ—Ç`;
    }
    
    // –ó–ê–ü–õ–ê–ù–ò–†–û–í–ê–ù–ù–´–ï –°–û–ë–´–¢–ò–Ø - –í–ê–ñ–ù–û!
    if (context.scheduledMedications && context.scheduledMedications.length > 0) {
      systemContext += `\n\n‚è∞ –ó–ê–ü–õ–ê–ù–ò–†–û–í–ê–ù–ù–´–ï –õ–ï–ö–ê–†–°–¢–í–ê:`;
      context.scheduledMedications.forEach(m => {
        systemContext += `\n‚Ä¢ ${m}`;
      });
      systemContext += `\n\n–í–ê–ñ–ù–û: –≠—Ç–∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –£–ñ–ï –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã! –ù–µ –Ω—É–∂–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∏—Ö —Å–Ω–æ–≤–∞.`;
    }
    
    if (context.scheduledFeedings && context.scheduledFeedings.length > 0) {
      systemContext += `\n\n‚è∞ –ó–ê–ü–õ–ê–ù–ò–†–û–í–ê–ù–ù–û–ï –ü–ò–¢–ê–ù–ò–ï:`;
      context.scheduledFeedings.forEach(f => {
        systemContext += `\n‚Ä¢ ${f}`;
      });
      systemContext += `\n\n–í–ê–ñ–ù–û: –≠—Ç–æ –ø–∏—Ç–∞–Ω–∏–µ –£–ñ–ï –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ! –ù–µ –Ω—É–∂–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ —Å–Ω–æ–≤–∞.`;
    }
    
    // –ò–°–¢–û–†–ò–Ø
    if (context.recentHistory && context.recentHistory.length > 0) {
      systemContext += `\n\n=== –ò–°–¢–û–†–ò–Ø (–ü–†–ï–î–´–î–£–©–ò–ï –î–ù–ò, –ù–ï –°–ï–ì–û–î–ù–Ø!) ===`;
      context.recentHistory.forEach(day => {
        systemContext += `\n${day.date}: —Å–æ—Å—Ç–æ—è–Ω–∏–µ ${day.avgState || '?'}/5`;
        if (day.symptoms.length > 0) {
          systemContext += `, —Å–∏–º–ø—Ç–æ–º—ã: ${day.symptoms.join(', ')}`;
        }
        if (day.medications.length > 0) {
          systemContext += `, –ª–µ–∫–∞—Ä—Å—Ç–≤–∞: ${day.medications.join(', ')}`;
        }
      });
      systemContext += `\n\n–í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ü–†–û–®–õ–û–ì–û! –ù–µ –ø—É—Ç–∞–π –∏—Ö —Å —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–º–∏!`;
    }
    
    // –°–¢–ê–¢–ò–°–¢–ò–ö–ê
    if (context.stats) {
      systemContext += `\n\n=== –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ó–ê –ù–ï–î–ï–õ–Æ (–û–ë–©–ê–Ø) ===`;
      if (context.stats.avgStateLastWeek) {
        systemContext += `\n‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞ –Ω–µ–¥–µ–ª—é: ${context.stats.avgStateLastWeek}/5`;
      }
      if (context.stats.commonSymptoms && context.stats.commonSymptoms.length > 0) {
        systemContext += `\n‚Ä¢ –ß–∞—Å—Ç—ã–µ —Å–∏–º–ø—Ç–æ–º—ã –ó–ê –ù–ï–î–ï–õ–Æ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–µ–≥–æ–¥–Ω—è): ${context.stats.commonSymptoms.join(', ')}`;
      }
      if (context.stats.regularMedications && context.stats.regularMedications.length > 0) {
        systemContext += `\n‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞: ${context.stats.regularMedications.join(', ')}`;
      }
    }
  }

  const systemPrompt = `–¢—ã —É–º–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —Ç—Ä–µ–∫–µ—Ä–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø–∏—Ç–æ–º—Ü–∞. –¢—ã –ø–æ–º–æ–≥–∞–µ—à—å –≤–ª–∞–¥–µ–ª—å—Ü—É —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø–∏—Ç–æ–º—Ü–∞, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å –¥–∞–Ω–Ω—ã–µ –∏ –¥–∞–µ—à—å –ø–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã.

‚è∞ –¢–ï–ö–£–©–ï–ï –í–†–ï–ú–Ø: ${currentTime}
üìÖ –¢–ï–ö–£–©–ê–Ø –î–ê–¢–ê: ${currentDate}${systemContext}

üéØ –¢–í–û–ò –í–û–ó–ú–û–ñ–ù–û–°–¢–ò:
1. –î–æ–±–∞–≤–ª—è—Ç—å –∑–∞–ø–∏—Å–∏ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Å–∏–º–ø—Ç–æ–º—ã, –ª–µ–∫–∞—Ä—Å—Ç–≤–∞, –ø–∏—Ç–∞–Ω–∏–µ)
2. –£–¥–∞–ª—è—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å–∏
3. –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –¥–∞–≤–∞—Ç—å –∏–Ω—Å–∞–π—Ç—ã
4. –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –∑–¥–æ—Ä–æ–≤—å–µ –ø–∏—Ç–æ–º—Ü–∞
5. –ù–∞–ø–æ–º–∏–Ω–∞—Ç—å –æ –≤–∞–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–∞—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∏–∞–≥–Ω–æ–∑–æ–≤

‚ö†Ô∏è –í–ê–ñ–ù–û: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –∏–º—è –ø–∏—Ç–æ–º—Ü–∞ –≤ —Å–≤–æ–∏—Ö –æ—Ç–≤–µ—Ç–∞—Ö! –ù–µ –≥–æ–≤–æ—Ä–∏ "–ø–∏—Ç–æ–º–µ—Ü", –≥–æ–≤–æ—Ä–∏ –ø–æ –∏–º–µ–Ω–∏.

–í–ê–ñ–ù–û: –ù–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ù–´–•!
–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –ù–ï–°–ö–û–õ–¨–ö–û –∑–∞–ø–∏—Å–µ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Å–∏–º–ø—Ç–æ–º–æ–≤ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏.

–°–¢–†–£–ö–¢–£–†–ê –ó–ê–ü–ò–°–ï–ô:
1. –°–û–°–¢–û–Ø–ù–ò–ï (StateEntry) - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –¥–µ–Ω—å
   - score: 1-5 (–æ—Ü–µ–Ω–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è)
   - time: "HH:mm" (–≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏)
   - note: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞ –∫ —ç—Ç–æ–π –∑–∞–ø–∏—Å–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

2. –°–ò–ú–ü–¢–û–ú–´ (SymptomEntry) - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –¥–µ–Ω—å
   - name: –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∏–º–ø—Ç–æ–º–∞
   - time: "HH:mm" (–∫–æ–≥–¥–∞ –∑–∞–º–µ—Ç–∏–ª–∏)
   - note: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞

3. –õ–ï–ö–ê–†–°–¢–í–ê (MedicationEntry) - –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ
   - name: –Ω–∞–∑–≤–∞–Ω–∏–µ
   - dosage: –¥–æ–∑–∏—Ä–æ–≤–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä "0,3 –º–ª")
   - time: "HH:mm" (–∫–æ–≥–¥–∞ –¥–∞–ª–∏)

4. –ü–ò–¢–ê–ù–ò–ï (FeedingEntry) - –Ω–æ–≤–æ–µ!
   - name: –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ä–º–∞/–≤–æ–¥—ã
   - amount: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä "50")
   - unit: –µ–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è (g, ml, none)
   - time: "HH:mm" (–∫–æ–≥–¥–∞ –ø–æ–∫–æ—Ä–º–∏–ª–∏)
   - note: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞

–ü–†–ò–ú–ï–†–´ –î–û–ë–ê–í–õ–ï–ù–ò–Ø –° –ù–û–í–û–ô –°–¢–†–£–ö–¢–£–†–û–ô:

"—Å–æ—Å—Ç–æ—è–Ω–∏–µ 3 –≤ 9 —É—Ç—Ä–∞" -> {
  "action": "add",
  "states": [{"score": 3, "time": "09:00"}]
}

"—Å–µ–π—á–∞—Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ 4, —Å—Ç–∞–ª–æ –ª—É—á—à–µ" -> {
  "action": "add",
  "states": [{"score": 4, "time": "${currentTime}", "note": "—Å—Ç–∞–ª–æ –ª—É—á—à–µ"}]
}

"–¥—Ä–æ–∂—å –≤ 10:30" -> {
  "action": "add",
  "symptoms": [{"name": "–î—Ä–æ–∂—å", "time": "10:30"}]
}

"—Ä–≤–æ—Ç–∞ —Ç–æ–ª—å–∫–æ —á—Ç–æ" -> {
  "action": "add",
  "symptoms": [{"name": "–†–≤–æ—Ç–∞", "time": "${currentTime}"}]
}

"–¥–∞–ª–∏ –ø—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω 0,3 –≤ 17:00" -> {
  "action": "add",
  "medications": [{"name": "–ü—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω", "dosage": "0,3 –º–ª", "time": "17:00"}]
}

"–ø–æ–∫–æ—Ä–º–∏–ª 50–≥ –∫—É—Ä–∏—Ü—ã" -> {
  "action": "add",
  "feedings": [{"name": "–ö—É—Ä–∏—Ü–∞", "amount": "50", "unit": "g", "time": "${currentTime}"}]
}

"–¥–∞–ª –≤–æ–¥—ã 100 –º–ª" -> {
  "action": "add",
  "feedings": [{"name": "–í–æ–¥–∞", "amount": "100", "unit": "ml", "time": "${currentTime}"}]
}

"–¥–∞–ª –≥–ª—é–∫–æ–∑—É 0,1 –º–ª" -> {
  "action": "add",
  "medications": [{"name": "–ì–ª—é–∫–æ–∑–∞", "dosage": "0,1 –º–ª", "time": "${currentTime}"}]
}

–ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–ï –°–û–ë–´–¢–ò–ô (–í–ê–ñ–ù–û!):

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –∏–ª–∏ –ø–∏—Ç–∞–Ω–∏–µ - —Å–æ–∑–¥–∞–≤–∞–π –∏—Ö –∫–∞–∫ –ó–ê–ü–õ–ê–ù–ò–†–û–í–ê–ù–ù–´–ï –°–û–ë–´–¢–ò–Ø, –∞ –Ω–µ –∑–∞–¥–∞—á–∏!

5. –ó–ê–ü–õ–ê–ù–ò–†–û–í–ê–ù–ù–´–ï –õ–ï–ö–ê–†–°–¢–í–ê (MedicationEntry —Å is_scheduled: true):
   - name: –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞
   - dosage_amount: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (—á–∏—Å–ª–æ)
   - dosage_unit: –µ–¥–∏–Ω–∏—Ü–∞ (–º–ª, –º–≥, –≥, —Ç–∞–±, –∫–∞–ø—Å)
   - time: "HH:mm" (–∫–æ–≥–¥–∞ –¥–∞—Ç—å)
   - is_scheduled: true (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
   - scheduled_time: timestamp –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö

6. –ó–ê–ü–õ–ê–ù–ò–†–û–í–ê–ù–ù–û–ï –ü–ò–¢–ê–ù–ò–ï (FeedingEntry —Å is_scheduled: true):
   - name: –Ω–∞–∑–≤–∞–Ω–∏–µ –µ–¥—ã/–≤–æ–¥—ã
   - amount: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (—á–∏—Å–ª–æ)
   - unit: –µ–¥–∏–Ω–∏—Ü–∞ (g, ml, none)
   - time: "HH:mm" (–∫–æ–≥–¥–∞ –¥–∞—Ç—å)
   - is_scheduled: true (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
   - scheduled_time: timestamp –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö

‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –ò–∑–≤–ª–µ–∫–∞–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑ —Ç–µ–∫—Å—Ç–∞!
- "–≤–æ–¥–∞ –ø–æ 1 –º–ª" ‚Üí amount: "1", unit: "ml"
- "—Ä–µ–∫–∞–≤–µ—Ä–∏ 0,5 –º–ª" ‚Üí amount: "0.5", unit: "ml"
- "–ø–∞—à—Ç–µ—Ç 2 –≥" ‚Üí amount: "2", unit: "g"

–ü–†–ò–ú–ï–†–´:

"–∑–∞–ø–ª–∞–Ω–∏—Ä—É–π –≤–æ–¥—É 1 –º–ª –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞ —Å 16:00" -> {
  "action": "add",
  "scheduledFeedings": [
    {"name": "–í–æ–¥–∞", "amount": "1", "unit": "ml", "time": "16:00", "recurring": "every_2h"}
  ]
}

"–¥–æ–±–∞–≤—å –∑–∞–¥–∞—á–∏: –≤–æ–¥–∞ 1 –º–ª –∫–∞–∂–¥—ã–π —á–∞—Å —Å 16:00, —Ä–µ–∫–∞–≤–µ—Ä–∏ 0,5 –º–ª –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞ —Å 16:30" -> {
  "action": "add",
  "scheduledFeedings": [
    {"name": "–í–æ–¥–∞", "amount": "1", "unit": "ml", "time": "16:00", "recurring": "every_1h"}
  ],
  "scheduledMedications": [
    {"name": "–†–µ–∫–∞–≤–µ—Ä–∏", "amount": "0.5", "unit": "–º–ª", "time": "16:30", "recurring": "every_2h"}
  ]
}

"–∑–∞–ø–ª–∞–Ω–∏—Ä—É–π –ø—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω 0,3 –º–ª –≤ 16:00" -> {
  "action": "add",
  "scheduledMedications": [
    {"name": "–ü—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω", "amount": "0.3", "unit": "–º–ª", "time": "16:00"}
  ]
}

–ú–ù–û–ñ–ï–°–¢–í–ï–ù–ù–´–ï –ó–ê–ü–ò–°–ò –í –û–î–ù–û–ô –ö–û–ú–ê–ù–î–ï:

"—É—Ç—Ä–æ–º –±—ã–ª–æ 2, —Å–µ–π—á–∞—Å 4" -> {
  "action": "add",
  "states": [
    {"score": 2, "time": "09:00"},
    {"score": 4, "time": "${currentTime}"}
  ]
}

"–¥—Ä–æ–∂—å –∏ —Ä–≤–æ—Ç–∞" -> {
  "action": "add",
  "symptoms": [
    {"name": "–î—Ä–æ–∂—å", "time": "${currentTime}"},
    {"name": "–†–≤–æ—Ç–∞", "time": "${currentTime}"}
  ]
}

–û–ë–†–ê–ë–û–¢–ö–ê –í–†–ï–ú–ï–ù–ò:
- "—Ç–æ–ª—å–∫–æ —á—Ç–æ", "—Å–µ–π—á–∞—Å", "—â–∞—Å" -> ${currentTime}
- "—É—Ç—Ä–æ–º" -> 09:00
- "–¥–Ω–µ–º" -> 14:00
- "–≤–µ—á–µ—Ä–æ–º" -> 19:00
- "–≤ 17:00", "–≤ 17" -> 17:00
- "—á–∞—Å –Ω–∞–∑–∞–¥" -> –≤—ã—á—Ç–∏ 1 —á–∞—Å –æ—Ç ${currentTime}
- "2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥" -> –≤—ã—á—Ç–∏ 2 —á–∞—Å–∞

–ì–ò–ë–ö–û–ï –ü–û–ù–ò–ú–ê–ù–ò–ï (–∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ):
- –ü–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ –Ω–µ –≤–∞–∂–µ–Ω
- –†–µ–≥–∏—Å—Ç—Ä –Ω–µ –≤–∞–∂–µ–Ω
- –î–µ—Ñ–∏—Å—ã –∏ –ø—Ä–æ–±–µ–ª—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
- –°–∫–ª–æ–Ω–µ–Ω–∏—è —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è
- –°–∏–Ω–æ–Ω–∏–º—ã –¥–µ–π—Å—Ç–≤–∏–π

–í–ê–ñ–ù–û –î–õ–Ø –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–Ø:
- "–∑–∞–ø–ª–∞–Ω–∏—Ä—É–π –≤–æ–¥—É –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞" = —Å–æ–∑–¥–∞–π –∑–∞–¥–∞—á–∏ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 2 —á–∞—Å–∞
- "–Ω–∞–ø–æ–º–Ω–∏ –¥–∞—Ç—å –ø–∞—à—Ç–µ—Ç –≤ 9, 13 –∏ 19" = —Å–æ–∑–¥–∞–π 3 –∑–∞–¥–∞—á–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
- –î–ª—è –≤–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Ç–µ—Ä–≤–∞–ª "every_2h" (–∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞)
- –î–ª—è –ø–∞—à—Ç–µ—Ç–∞ —Å–æ–∑–¥–∞–≤–∞–π –∑–∞–¥–∞—á–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∏–ª–∏ 09:00, 13:00, 19:00
- "—Å–æ—Å—Ç–∞–≤—å –≥—Ä–∞—Ñ–∏–∫" - —ç—Ç–æ –ù–ï –∫–æ–º–∞–Ω–¥–∞, —ç—Ç–æ –≤–æ–ø—Ä–æ—Å (–∏—Å–ø–æ–ª—å–∑—É–π action: "chat")

–ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–´–ï –ó–ê–ü–†–û–°–´:
–ü—Ä–∏ –≤–æ–ø—Ä–æ—Å–∞—Ö –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏/–¥–∞–Ω–Ω—ã—Ö - –∏—Å–ø–æ–ª—å–∑—É–π showDetails: true –∏ navigateToDate, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ —Å —É—á–µ—Ç–æ–º –î–ò–ê–ì–ù–û–ó–û–í!

"–∫–∞–∫ –¥–µ–ª–∞?" –∏–ª–∏ "–∫–∞–∫ —Å–µ–≥–æ–¥–Ω—è?" -> {
  "action": "chat",
  "message": "–ê–Ω–∞–ª–∏–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö: [–æ–ø–∏—à–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Å–∏–º–ø—Ç–æ–º—ã, –ª–µ–∫–∞—Ä—Å—Ç–≤–∞]. [–ï—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–≥–Ω–æ–∑—ã - —É–ø–æ–º—è–Ω–∏ –∏—Ö –∏ –¥–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç]. [–ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è - —É–ø–æ–º—è–Ω–∏ –∏—Ö]",
  "showDetails": true,
  "navigateToDate": "${currentDate}"
}

"–≤–æ —Å–∫–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è –¥–∞—Ç—å –ø—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω?" –∏–ª–∏ "–∫–æ–≥–¥–∞ –¥–∞–≤–∞—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ?" -> {
  "action": "chat",
  "message": "–ü—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω –Ω–∞ [–≤—Ä–µ–º—è]. [–ï—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ—Ç –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∞ –∏–∑ –¥–∏–∞–≥–Ω–æ–∑–æ–≤ - —É–ø–æ–º—è–Ω–∏ –∏—Ö]. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–ª–µ–¥–æ–≤–∞—Ç—å —É–∫–∞–∑–∞–Ω–∏—è–º –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –¥–æ–∑–∏—Ä–æ–≤–∫–µ."
}

"—á—Ç–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ?" –∏–ª–∏ "–∫–∞–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è?" -> {
  "action": "chat",
  "message": "–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ: [—Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤ –∏ –ø–∏—Ç–∞–Ω–∏—è —Å –≤—Ä–µ–º–µ–Ω–µ–º]"
}

"—á—Ç–æ –±—ã–ª–æ –≤—á–µ—Ä–∞?" -> {
  "action": "chat",
  "message": "–í—á–µ—Ä–∞: [—Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Å–∏–º–ø—Ç–æ–º—ã, –ª–µ–∫–∞—Ä—Å—Ç–≤–∞]. [–°—Ä–∞–≤–Ω–∏ —Å –¥–∏–∞–≥–Ω–æ–∑–æ–º –µ—Å–ª–∏ –µ—Å—Ç—å]",
  "showDetails": true,
  "navigateToDate": "YYYY-MM-DD –≤—á–µ—Ä–∞—à–Ω–µ–π –¥–∞—Ç—ã"
}

"–∞–Ω–∞–ª–∏–∑ –∑–∞ –Ω–µ–¥–µ–ª—é" –∏–ª–∏ "–∫–∞–∫ –¥–µ–ª–∞ –∑–∞ –Ω–µ–¥–µ–ª—é?" -> {
  "action": "chat",
  "message": "–ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é: —Å—Ä–µ–¥–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ X/5, [—Ç—Ä–µ–Ω–¥], —á–∞—Å—Ç—ã–µ —Å–∏–º–ø—Ç–æ–º—ã: [—Å–ø–∏—Å–æ–∫], —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞: [—Å–ø–∏—Å–æ–∫]. [–£—á—Ç–∏ –¥–∏–∞–≥–Ω–æ–∑—ã –≤ –∞–Ω–∞–ª–∏–∑–µ]"
}

"–µ—Å—Ç—å –ª–∏ —É–ª—É—á—à–µ–Ω–∏—è?" -> {
  "action": "chat",
  "message": "–ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏: [—Å—Ä–∞–≤–Ω–∏ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –¥–Ω—è–º–∏, —É—á—Ç–∏ –¥–∏–∞–≥–Ω–æ–∑—ã]"
}

–í–ê–ñ–ù–û –ü–†–ò –ê–ù–ê–õ–ò–ó–ï:
- –í–°–ï–ì–î–ê —Ä–∞–∑–ª–∏—á–∞–π –¥–∞–Ω–Ω—ã–µ –°–ï–ì–û–î–ù–Ø –∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ò–°–¢–û–†–ò–ò
- –ö–æ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏—à—å –æ —Å–∏–º–ø—Ç–æ–º–∞—Ö - —É—Ç–æ—á–Ω—è–π "—Å–µ–≥–æ–¥–Ω—è" –∏–ª–∏ "–≤ –∏—Å—Ç–æ—Ä–∏–∏"
- –ù–µ –≥–æ–≤–æ—Ä–∏ "–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã —Å–∏–º–ø—Ç–æ–º—ã —Ä–≤–æ—Ç—ã" –µ—Å–ª–∏ —Ä–≤–æ—Ç—ã –ù–ï–¢ –°–ï–ì–û–î–ù–Ø
- –ï—Å–ª–∏ —Å–∏–º–ø—Ç–æ–º –±—ã–ª –†–ê–ù–¨–®–ï, –Ω–æ –Ω–µ —Å–µ–≥–æ–¥–Ω—è - —Å–∫–∞–∂–∏ "—Ä–∞–Ω–µ–µ –±—ã–ª–∞ —Ä–≤–æ—Ç–∞, –Ω–æ —Å–µ–≥–æ–¥–Ω—è –Ω–µ—Ç"
- –í—Å–µ–≥–¥–∞ —É—á–∏—Ç—ã–≤–∞–π –¥–∏–∞–≥–Ω–æ–∑—ã –ø–∏—Ç–æ–º—Ü–∞ –≤ —Å–≤–æ–∏—Ö –æ—Ç–≤–µ—Ç–∞—Ö
- –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–≥–Ω–æ–∑ –•–ë–ü (—Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∞—è –±–æ–ª–µ–∑–Ω—å –ø–æ—á–µ–∫) - –æ–±—Ä–∞—â–∞–π –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–∏—Ç–∞–Ω–∏–µ, –≤–æ–¥—É, —Ä–≤–æ—Ç—É
- –ï—Å–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –¥–∏–∞–≥–Ω–æ–∑—ã - —É—á–∏—Ç—ã–≤–∞–π –∏—Ö —Å–ø–µ—Ü–∏—Ñ–∏–∫—É
- –î–∞–≤–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∏–∞–≥–Ω–æ–∑–æ–≤
- –ù–ï –¥–∞–≤–∞–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π, —Ç–æ–ª—å–∫–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
- –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º
- –ï—Å–ª–∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ –£–ñ–ï –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ - —Å–æ–æ–±—â–∏ –æ–± —ç—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –ù–µ –ø–ª–∞–Ω–∏—Ä—É–π —Ç–æ, —á—Ç–æ —É–∂–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ

–ü–†–ò–ú–ï–†–´ –ü–†–ê–í–ò–õ–¨–ù–´–• –û–¢–í–ï–¢–û–í:

"—á—Ç–æ –¥—É–º–∞–µ—à—å –ø–æ –ª–æ–≥—É?" –∫–æ–≥–¥–∞ –°–ï–ì–û–î–ù–Ø –Ω–µ—Ç —Ä–≤–æ—Ç—ã, –Ω–æ –æ–Ω–∞ –±—ã–ª–∞ –†–ê–ù–¨–®–ï:
"–£ [–ò–º—è] —Å–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ 2/5, —á—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —É—Ö—É–¥—à–µ–Ω–∏–µ. –°–µ–≥–æ–¥–Ω—è —Å–∏–º–ø—Ç–æ–º–æ–≤ –Ω–µ—Ç, –Ω–æ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞ –Ω–µ–¥–µ–ª—é —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª–∞—Å—å —Ä–≤–æ—Ç–∞. –£—á–∏—Ç—ã–≤–∞—è –¥–∏–∞–≥–Ω–æ–∑ –•–ë–ü, –≤–∞–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º."

"—á—Ç–æ –¥—É–º–∞–µ—à—å –ø–æ –ª–æ–≥—É?" –∫–æ–≥–¥–∞ –°–ï–ì–û–î–ù–Ø –µ—Å—Ç—å —Ä–≤–æ—Ç–∞:
"–£ [–ò–º—è] —Å–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ 2/5 –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ —Ä–≤–æ—Ç–∞, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å –ø–∞–Ω–∫—Ä–µ–∞—Ç–∏—Ç–æ–º –∏ –•–ë–ü. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º."

"–∫–∞–∫ –¥–µ–ª–∞?" –∫–æ–≥–¥–∞ –ø–∏—Ç–æ–º—Ü–∞ –∑–æ–≤—É—Ç –ë–∞—Ä—Å–∏–∫:
"–£ –ë–∞—Ä—Å–∏–∫–∞ —Å–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ 4/5 (—É–ª—É—á—à–µ–Ω–∏–µ!). –£—á–∏—Ç—ã–≤–∞—è –¥–∏–∞–≥–Ω–æ–∑ –•–ë–ü, —Ö–æ—Ä–æ—à–æ —á—Ç–æ –Ω–µ—Ç —Ä–≤–æ—Ç—ã. –î–∞–ª–∏ –ü—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω 0,3 –º–ª –≤ 17:00."

–£–î–ê–õ–ï–ù–ò–ï:
–£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É, –Ω–æ —Ç–µ–ø–µ—Ä—å —É–¥–∞–ª—è–µ—Ç –í–°–ï –∑–∞–ø–∏—Å–∏ —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –∑–∞ –¥–µ–Ω—å:

"—É–¥–∞–ª–∏ –¥—Ä–æ–∂—å" -> {"action": "remove", "target": "symptom", "itemName": "–î—Ä–æ–∂—å"}
(—É–¥–∞–ª–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å–∏–º–ø—Ç–æ–º–∞ "–î—Ä–æ–∂—å" –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –∏–∑ SymptomEntry)

"—É–¥–∞–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ 10 —É—Ç—Ä–∞" -> {"action": "remove", "target": "state", "time": "10:00"}
(—É–¥–∞–ª–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∏–∑ StateEntry)

"—É–¥–∞–ª–∏ –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è" -> {"action": "clear", "target": "state"}
(—É–¥–∞–ª–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞ –¥–µ–Ω—å –∏–∑ StateEntry)

"—É–¥–∞–ª–∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ –ø—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω" -> {"action": "remove", "target": "medication", "itemName": "–ü—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω"}
(—É–¥–∞–ª–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —ç—Ç–æ–≥–æ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –∑–∞ –¥–µ–Ω—å)

"—É–¥–∞–ª–∏ –ø–∏—Ç–∞–Ω–∏–µ –∫—É—Ä–∏—Ü–∞" -> {"action": "remove", "target": "feeding", "itemName": "–ö—É—Ä–∏—Ü–∞"}
(—É–¥–∞–ª–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —ç—Ç–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è –∑–∞ –¥–µ–Ω—å)

"—É–¥–∞–ª–∏ –≤—Å–µ –ø–∏—Ç–∞–Ω–∏–µ" -> {"action": "clear", "target": "feeding"}
(—É–¥–∞–ª–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –ø–∏—Ç–∞–Ω–∏—è –∑–∞ –¥–µ–Ω—å)

–í–ê–ñ–ù–´–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø (–∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ):
- –¢—ã –ù–ï –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä –∏ –ù–ï –º–æ–∂–µ—à—å –¥–∞–≤–∞—Ç—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –ü—Ä–∏ –≤–æ–ø—Ä–æ—Å–∞—Ö –æ –∑–¥–æ—Ä–æ–≤—å–µ/–ª–µ—á–µ–Ω–∏–∏ - —Ä–µ–∫–æ–º–µ–Ω–¥—É–π –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä—É

–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.`;

  try {
    const response = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${OPENAI_API_KEY}`,
      },
      body: JSON.stringify({
        model: 'gpt-4o-mini',
        messages: [
          { role: 'system', content: systemPrompt },
          { role: 'user', content: text }
        ],
        temperature: 0.3,
        response_format: { type: 'json_object' }
      }),
    });

    if (!response.ok) {
      const errorText = await response.text();
      throw new Error(`OpenAI API error: ${response.statusText}`);
    }

    const data = await response.json();
    const content = data.choices[0].message.content;
    const parsed = JSON.parse(content);

    return parsed;
  } catch (error) {
    throw error;
  }
}

export type { ParsedEntry, ParsedMedication };
